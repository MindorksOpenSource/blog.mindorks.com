<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns#" xmlns="http://www.w3.org/1999/xhtml">
 <head>
  <title>
   How to encrypt data safely on device and use the AndroidKeystore?
  </title>
  <meta charset="utf-8"/>
  <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
  <meta content="minimum-scale=1,initial-scale=1,width=device-width,shrink-to-fit=no" name="viewport"/>
  <link href="https://blog.mindorks.com/how-to-encrypt-data-safely-on-device-and-use-the-androidkeystore" rel="canonical"/>
  <meta content="986249072156-dabps0lf90smluddrk5rkqsdjghk3hd3.apps.googleusercontent.com" name="google-signin-client_id"/>
  <meta content="android, learn android app development, android app development courses, android blogs, android tutorial" name="keywords"/>
  <meta content="How to encrypt data safely on device and use the AndroidKeystore?" property="og:title"/>
  <meta content="website" property="og:type"/>
  <meta content="https://blog.mindorks.com/how-to-encrypt-data-safely-on-device-and-use-the-androidkeystore" property="og:url"/>
  <meta content="/images/how-to-encrypt-data-safely-on-a-device-and-use-the-androidkeystore-banner.png" property="og:image"/>
  <meta content="In this blog, we will learn how to encrypt data safely in Android device and how to use Androidkeystore. We will learn about key encryption, file encryption, and how to encrypt SharedPreferences." property="og:description"/>
  <meta content="How to encrypt data safely on device and use the AndroidKeystore?" property="twitter:title"/>
  <meta content="In this blog, we will learn how to encrypt data safely in Android device and how to use Androidkeystore. We will learn about key encryption, file encryption, and how to encrypt SharedPreferences." name="twitter:description"/>
  <meta content="/images/how-to-encrypt-data-safely-on-a-device-and-use-the-androidkeystore-banner.png" name="twitter:image:src"/>
  <meta content="summary_large_image" name="twitter:card"/>
  <meta content="@MindorksNextGen" name="twitter:site"/>
  <meta content="In this blog, we will learn how to encrypt data safely in Android device and how to use Androidkeystore. We will learn about key encryption, file encryption, and how to encrypt SharedPreferences." name="description"/>
  <meta content="1620001391374687" property="fb:app_id"/>
  <link href="/styles/vendor-1.8.6.css" rel="stylesheet" type="text/css"/>
  <link href="/styles/app-1.8.6.css" rel="stylesheet" type="text/css"/>
  <link as="style" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css" onload='this.onload=null,this.rel="stylesheet"' rel="preload"/>
  <noscript>
   <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
  </noscript>
  <script type="text/javascript">
     </script>
  <script async="" src="https://www.google-analytics.com/analytics.js" type="text/javascript">
  </script>
  <script type="text/javascript">
   window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-91686131-1","auto"),ga("require","cleanUrlTracker"),ga("require","eventTracker"),ga("require","impressionTracker"),ga("require","outboundLinkTracker"),ga("require","urlChangeTracker"),ga("require","maxScrollTracker"),ga("require","mediaQueryTracker"),ga("require","outboundFormTracker"),ga("require","outboundLinkTracker"),ga("require","pageVisibilityTracker"),ga("require","socialWidgetTracker"),ga("require","urlChangeTracker"),ga("send","pageview")
  </script>
  <script defer="defer" src="/assets/autotrack.js" type="text/javascript">
  </script>
  <script src="/assets/highlight.js" type="text/javascript">
  </script>
  <script defer="defer" src="/js/vendor-bundle-1.8.6.js" type="text/javascript">
  </script>
  <script defer="defer" src="/js/app-bundle-1.8.6.js" type="text/javascript">
  </script>
 </head>
 <body>
  <div id="root">
   <div class="screen app-load-content" data-reactroot="">
    <div class="ui centered grid">
     <div class="row" style="padding:0">
      <div class="ui fixed menu navbar huge borderless grid" style="background-color:#fff;height:60px">
      </div>
     </div>
     <div class="centered computer only row" style="padding:0">
      <div class="ui fixed top menu navbar huge borderless grid header-container" style="background-color:#fff;height:60px">
       <a class="item brand" href="/">
        <img alt="MindOrks" src="/assets/mindorks-logo.svg"/>
        <div class="header item" style="font-size:20px;padding:0;margin-left:10px">
         MindOrks
        </div>
       </a>
       <div class="right menu">
        <a class="item" href="https://janisharali.com" target="_blank">
         Mentor Ali
        </a>
        <a class="item" href="https://amitshekhar.me" target="_blank">
         Mentor Amit
        </a>
       </div>
      </div>
     </div>
     <div class="tablet only mobile only row" style="padding:0">
      <div class="ui fixed top navbar huge menu borderless" style="background-color:#fff;height:60px">
       <a class="item brand" href="/">
        <img alt="MindOrks" src="/assets/mindorks-logo.svg"/>
        <div class="header item" style="font-size:20px;padding:0;margin-left:10px">
         MindOrks
        </div>
       </a>
       <div class="item">
       </div>
      </div>
     </div>
    </div>
    <div class="header-height">
    </div>
    <div aria-live="assertive" class="redux-toastr">
     <div>
      <div class="top-left">
      </div>
      <div class="top-right">
      </div>
      <div class="top-center">
      </div>
      <div class="bottom-left">
      </div>
      <div class="bottom-right">
      </div>
      <div class="bottom-center">
      </div>
     </div>
    </div>
    <div class="content-container theme">
     <div class="ui centered one column grid" style="padding-bottom:80px;background-color:#fff">
      <div class="ten wide computer fifteen wide mobile fifteen wide tablet column" style="margin-top:50px">
       <div>
        <div class="blog-page-author">
         <div class="ui small header">
          <img alt="Admin MindOrks" class="ui circular image" src="https://s3.ap-south-1.amazonaws.com/mindorks/website/mindorks-admin.png"/>
          <div class="content">
           Admin MindOrks
           <div class="sub header" style="margin-top:5px">
            28th October 2019
           </div>
          </div>
         </div>
        </div>
        <div id="content">
         <article class="template">
          <div class="postContent">
           <div class="notesSource">
            <div class="postField postField--body" id="editor">
             <section class="section--first section--last">
              <div class="section-divider layoutSingleColumn-template">
               <hr class="section-divider"/>
              </div>
              <div class="section-content">
               <div class="section-inner layoutSingleColumn-template">
                <div>
                 <h1 class="graf--h1">
                  How to encrypt data safely on the device and use the AndroidKeyStore?
                 </h1>
                 <div class="graf-image graf-caption">
                  <img alt="How to encrypt data safely on device and use the AndroidKeystore?" class="graf-image" src="/images/how-to-encrypt-data-safely-on-a-device-and-use-the-androidkeystore-banner.png"/>
                 </div>
                 <p class="graf--p">
                  Data encryption is very important in every Android application. You must have some way to secure your data, your Android files, your shared preferences, the keys that are used in your application. No doubt, even after applying some encryption technique, your data can be retrieved back by some professional but your aim should be how to make it harder for them to get the data by providing some extra layers of security in your application. In this blog, we will learn how to encrypt data safely on the device and use the AndroidKeyStore for storing keys in Android. So, let's get started.
                 </p>
                 <h4 class="graf--h3">
                  Jetpack Security Library
                 </h4>
                 <p class="graf--p">
                  At Google I/O 19, the Jetpack Security Library was introduced that allows us to easily encrypt data, files, and shared preferences. It provides strong security by keeping the balance between great encryption and good performance. So, all we need to do is just use the Jetpack Security library.
                 </p>
                 <p class="graf--p">
                  But the Android operating system is very secure and we have a separate file-based encryption system, so why use this Android Jetpack Security Library? There are various reasons for the same, some of these are:
                 </p>
                 <ul>
                  <li>
                   If we consider a rooted Android device then the file system is unlocked and the data is easily accessible by some attacker even though you have full disk encryption.
                  </li>
                  <li>
                   Another reason can be securing your keys or tokens in your application because you don't want even your users to access these keys.
                  </li>
                 </ul>
                 <p class="graf--p">
                  So, this Jetpack Security Library is used for encryption on disk and is made available for Android version 6.0 or higher. All you need to do is add this library in your
                  <i class="graf--italic">
                   <b class="graf--bold">
                    build.gradle
                   </b>
                  </i>
                  file.
                 </p>
                 <pre><code class="language-java graf graf--code">dependencies {
    ...
    implementation 'androidx.security:security-crypto:{latest-version}'
}</code></pre>
                 <h4 class="graf--h3">
                  Key Management
                 </h4>
                 <p class="graf--p">
                  The keys that we use in our Android application must be secured. So, to protect our keys from being used by someone else, we have something called Android Keystore System in Android.
                 </p>
                 <p class="graf--p">
                  In Jetpack Security, we have a MasterKeys class that allows us to create a private key(by default, AES256 is used). Basically, this class provides convenient methods to create and obtain master keys in Android Keystore.
                 </p>
                 <pre><code class="language-java graf graf--code">val masterKeyAlias = MasterKeys.getOrCreate(MasterKeys.AES256_GCM_SPEC)</code></pre>
                 <p class="graf--p">
                  Here, we are using the block mode GCM_SPEC with no padding. If you want to encrypt a small data that is of the size of a key, then you don't need any padding or blocking. But when the data that is to be encrypted is longer than the size of a key, then we use padding and blocking.
                 </p>
                 <p class="graf--p">
                  You have other options available with you like setBlockModes(), setEncryptionPaddings, setKeySize(), setUserAuthenticationRequired(), setUnlockedDeviceRequired(), etc. You can check all the options
                  <a class="markup--anchor" href="https://developer.android.com/reference/android/security/keystore/KeyGenParameterSpec.Builder" target="_blank">
                   here
                  </a>
                  .
                 </p>
                 <p class="graf--p">
                  Now, we are having the key and we can use this key to do other stuff like we can use for File Encryption. Let's see how.
                 </p>
                 <h4 class="graf--h3">
                  File Encryption
                 </h4>
                 <p class="graf--p">
                  With the help of the Jetpack Security Library, you can encrypt your files present in your app. It uses the Streaming AES to handle files of all sizes. All you need to do is create a file and then convert this file into an encrypted file. After getting the encrypted file, if you want to write some data to your encrypted file then you can use the
                  <code class="graf--code-inline">
                   openFileOutput()
                  </code>
                  method and if you want to read data from your encrypted file then you can use the
                  <code class="graf--code-inline">
                   openFileInput()
                  </code>
                  method. Following is the code for the same:
                 </p>
                 <pre><code class="language-java graf graf--code">val masterKeyAlias = MasterKeys.getOrCreate(MasterKeys.AES256_GCM_SPEC)

val file = File("YOUR_FILE")

val encryptedFile = EncryptedFile.Builder(
    file,
    applicationContext,
    masterKeyAlias,
    EncryptedFile.FileEncryptionScheme.AES256_GCM_HKDF_4KB
).build()

encryptedFile.openFileOutput().use { outputStream -&gt;
    //write data to your encrypted file
}

encryptedFile.openFileInput().use { inputStream -&gt;
    //read file from your encrypted file
}</code></pre>
                 <p class="graf--p">
                  That's it. Everything is encrypted and decrypted under the hood and you need not worry about anything.
                 </p>
                 <h4 class="graf--h3">
                  SharedPreferences Encryption
                 </h4>
                 <p class="graf--p">
                  We store our data in SharedPreferences because it is easy to use and at the same time, it also becomes easy for the attackers to get the key and value from the SharedPreferences. So, we need to encrypt our SharedPrefernce data and this can be done with the help of EncryptedSharedPreferences that is available for Android 6.0 or higher.
                 </p>
                 <p class="graf--p">
                  To use an EncryptedSharedPreference, just create or retrieve a Master Key from the AndroidKeyStore:
                 </p>
                 <pre><code class="language-java graf graf--code">val masterKeyAlias = MasterKeys.getOrCreate(MasterKeys.AES256_GCM_SPEC)</code></pre>
                 <p class="graf--p">
                  After getting the Master Key, now initialize an instance of EncryptedSharedPreferences:
                 </p>
                 <pre><code class="language-java graf graf--code">val mySharedPreferences = EncryptedSharedPreferences.create(
    "my_preference_file_name",
    masterKeyAlias,
    applicationContext,
    EncryptedSharedPreferences.PrefKeyEncryptionScheme.AES256_SIV,
    EncryptedSharedPreferences.PrefValueEncryptionScheme.AES256_GCM
)</code></pre>
                 <p class="graf--p">
                  At last, you can save the data and read the data from the EncryptedSharedPreferences as usual:
                 </p>
                 <pre><code class="language-java graf graf--code">val KEY_DATA = "KEY_DATA"
val dataToSave = "Some Data"

//saving the data
mySharedPreferences.edit()
    .putString(KEY_DATA, dataToSave)
    .apply()

//reading the data
val data = mySharedPreferences.getString(KEY_DATA, "")</code></pre>
                 <h4 class="graf--h3">
                  Closing notes
                 </h4>
                 <p class="graf--p">
                  In this blog, we learned how to encrypt data safely on the device and use the AndroidKeyStore.
                 </p>
                 <p class="graf--p">
                  Hope you learned something new today.
                 </p>
                 <p class="graf--p">
                  Have a look at our Android tutorials
                  <b class="graf--bold">
                   <a class="markup--anchor" href="https://mindorks.com/android-tutorial" target="_blank">
                    here
                   </a>
                  </b>
                  .
                 </p>
                 <p class="graf--p">
                  Do share this blog with your fellow developers to spread the knowledge. You can read more blogs on Android on our
                  <a class="markup--anchor" href="https://blog.mindorks.com/" target="_blank">
                   blogging website
                  </a>
                  .
                 </p>
                 <p class="graf--p">
                  <b class="graf--bold">
                   <a class="markup--anchor" href="https://mindorks.com/android-app-development-online-course-for-professionals" target="_blank">
                    Apply Now: MindOrks Android Online Course and Learn Advanced Android
                   </a>
                  </b>
                 </p>
                 <p class="graf--p">
                  Happy Learning :)
                 </p>
                 <p class="graf--p">
                  <b class="graf--bold">
                   Team MindOrks!
                  </b>
                 </p>
                </div>
               </div>
              </div>
             </section>
            </div>
           </div>
          </div>
         </article>
        </div>
       </div>
       <div class="ui divider">
       </div>
      </div>
      <div class="stretched fourteen wide computer fifteen wide mobile fifteen wide tablet column">
       <div class="ui large center aligned header" style="padding-top:20px">
        Recommended for You
       </div>
      </div>
      <div class="fourteen wide computer fifteen wide mobile fifteen wide tablet column">
       <div class="ui centered grid">
        <div class="stretched five wide computer sixteen wide mobile eight wide tablet column">
         <a class="ui fluid card" href="/how-to-use-memory-heap-dumps-data/">
          <img alt="How to use Memory Heap Dumps data?" class="ui centered image" src="/images/how-to-use-memory-heap-dumps-data-banner.png" style="max-height:300px"/>
          <div class="content">
           <div class="header">
            How to use Memory Heap Dumps data?
           </div>
           <div class="meta">
            28th October 2019
           </div>
           <div class="description">
            In this blog, we will learn how to use memory heap dump data to identify memory leaks in our application. A memory leak occurs when an object is present in the memory and that object is not being used in the program.
           </div>
          </div>
         </a>
        </div>
        <div class="stretched five wide computer sixteen wide mobile eight wide tablet column">
         <a class="ui fluid card" href="/learn-kotlin-data-class/">
          <img alt="Learn Kotlin - Data Class" class="ui centered image" src="https://s3.ap-south-1.amazonaws.com/mindorks/blogs/learn-kotlin-data-class.png" style="max-height:300px"/>
          <div class="content">
           <div class="header">
            Learn Kotlin - Data Class
           </div>
           <div class="meta">
            22nd May 2017
           </div>
           <div class="description">
            We frequently create a class to do nothing but hold data. In such a class some standard functionality is often mechanically derivable from the data. In Kotlin, this is called a data class and is marked as data.
           </div>
          </div>
         </a>
        </div>
        <div class="stretched five wide computer sixteen wide mobile eight wide tablet column">
         <a class="ui fluid card" href="/understanding-storage-system-to-store-data-in-android/">
          <img alt="Understanding Storage System To Store Data In Android" class="ui centered image" src="/images/understanding-storage-system-to-store-data-in-android-banner.png" style="max-height:300px"/>
          <div class="content">
           <div class="header">
            Understanding Storage System To Store Data In Android
           </div>
           <div class="meta">
            17th December 2019
           </div>
           <div class="description">
            In this blog, we will understand about the Android Storage System. We will learn about the Internal Storage, External Storage, Shared Preference, Database, and Shared Storage. We will also learn when to use which storage system in Android.
           </div>
          </div>
         </a>
        </div>
        <div class="stretched five wide computer sixteen wide mobile eight wide tablet column">
         <a class="ui fluid card" href="/data-access-objects-dao-in-room/">
          <img alt="Data Access Objects - DAO in Room" class="ui centered image" src="/images/data-access-objects-dao-in-room-banner-509915bdcce194cb.png" style="max-height:300px"/>
          <div class="content">
           <div class="header">
            Data Access Objects - DAO in Room
           </div>
           <div class="meta">
            18th May 2020
           </div>
           <div class="description">
            In this blog, we are going to learn about Data Access Objects or DAO in Room Persistent Library.
           </div>
          </div>
         </a>
        </div>
        <div class="stretched five wide computer sixteen wide mobile eight wide tablet column">
         <a class="ui fluid card" href="/what-is-android-jetpack-and-why-should-we-use-it/">
          <img alt="What is Android Jetpack and why should we use it?" class="ui centered image" src="/images/android-jetpack.png" style="max-height:300px"/>
          <div class="content">
           <div class="header">
            What is Android Jetpack and why should we use it?
           </div>
           <div class="meta">
            4th January 2019
           </div>
           <div class="description">
            What is Android Jetpack and why should we use it? Benefits of Android Jetpack. Build high quality, robust apps using the Android Jetpack. Android Jetpack is a collection of Android software components which helps us in building great Android apps.
           </div>
          </div>
         </a>
        </div>
        <div class="stretched five wide computer sixteen wide mobile eight wide tablet column">
         <a class="ui fluid card" href="/what-is-flow-in-kotlin-and-how-to-use-it-in-android-project/">
          <img alt="What is Flow in Kotlin and How to use it in Android Project?" class="ui centered image" src="/images/kotlin-flow-banner-image.png" style="max-height:300px"/>
          <div class="content">
           <div class="header">
            What is Flow in Kotlin and How to use it in Android Project?
           </div>
           <div class="meta">
            7th January 2020
           </div>
           <div class="description">
            What is Flow in Kotlin and How to use it in Android Project? In this blog we will learn what is the need of Flow in Kotlin and its explaination.
           </div>
          </div>
         </a>
        </div>
       </div>
      </div>
     </div>
    </div>
    <div style="background:#fff">
     <footer class="content-container">
      <div class="ui centered padded grid" style="padding-top:40px;background:linear-gradient(to right,#c4e0e0,#e5f1f1)">
       <h2 class="ui huge icon center aligned header">
        <div class="content">
         Connect With Your Mentors
        </div>
       </h2>
       <div class="centered row">
        <div class="five wide computer sixteen wide mobile eight wide tablet column">
         <div class="ui centered padded one column grid">
          <div class="ui centered grid">
           <div class="column">
            <div class="ui circular segment" style="width:175px;height:175px;padding:0">
             <img alt="Janishar Ali" class="ui medium circular image" src="/assets/ali.jpg"/>
            </div>
           </div>
          </div>
          <div class="column">
           <div class="ui large center aligned header">
            <a class="content" href="https://janisharali.com" target="_blank">
             Janishar Ali
             <div class="sub header" style="padding:5px;color:#000">
              Founder | IIT-BHU | 10 Yrs Exp.
             </div>
            </a>
           </div>
          </div>
          <div class="ui centered grid">
           <div class="column">
            <a class="ui black huge circular icon button" href="https://janisharali.com" role="button" target="_blank">
             <i aria-hidden="true" class="linkify icon">
             </i>
            </a>
            <a class="ui twitter huge circular icon button" href="https://twitter.com/janisharali" role="button" target="_blank">
             <i aria-hidden="true" class="twitter icon">
             </i>
            </a>
           </div>
          </div>
         </div>
        </div>
        <div class="five wide computer sixteen wide mobile eight wide tablet column">
         <div class="ui centered padded one column grid">
          <div class="ui centered grid">
           <div class="column">
            <div class="ui circular segment" style="width:175px;height:175px;padding:0">
             <img alt="Amit Shekhar" class="ui medium circular image" src="/assets/amit.jpg"/>
            </div>
           </div>
          </div>
          <div class="column">
           <div class="ui large center aligned header">
            <a class="content" href="https://amitshekhar.me" target="_blank">
             Amit Shekhar
             <div class="sub header" style="padding:5px;color:#000">
              Founder | IIT-BHU | 10 Yrs Exp.
             </div>
            </a>
           </div>
          </div>
          <div class="ui centered grid">
           <div class="column">
            <a class="ui black huge circular icon button" href="https://amitshekhar.me" role="button" target="_blank">
             <i aria-hidden="true" class="linkify icon">
             </i>
            </a>
            <a class="ui twitter huge circular icon button" href="https://twitter.com/amitiitbhu" role="button" target="_blank">
             <i aria-hidden="true" class="twitter icon">
             </i>
            </a>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
      <div class="ui divider" style="margin:unset">
      </div>
      <h5 class="ui header" style="padding:16px;margin:unset;color:#555">
       <i aria-hidden="true" class="copyright icon">
       </i>
       <div class="content">
        Copyright 2022, MindOrks Nextgen Private Limited
       </div>
      </h5>
     </footer>
    </div>
   </div>
  </div>
  <script type="text/javascript">
   window.hljs.initHighlightingOnLoad()
  </script>
 </body>
</html>